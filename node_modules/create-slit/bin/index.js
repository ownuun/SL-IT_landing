#!/usr/bin/env node

const fs = require('fs');
const path = require('path');

// í”„ë¡œì íŠ¸ ì´ë¦„ ê°€ì ¸ì˜¤ê¸°
const projectName = process.argv[2];

if (!projectName) {
  console.error('âŒ í”„ë¡œì íŠ¸ ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
  console.log('\nì‚¬ìš©ë²•: npm create slit <project-name>');
  console.log('ì˜ˆì‹œ: npm create slit my-team-page\n');
  process.exit(1);
}

const targetDir = path.join(process.cwd(), projectName);

// ì´ë¯¸ í´ë”ê°€ ìˆëŠ”ì§€ í™•ì¸
if (fs.existsSync(targetDir)) {
  console.error(`âŒ "${projectName}" í´ë”ê°€ ì´ë¯¸ ì¡´ì¬í•©ë‹ˆë‹¤.`);
  process.exit(1);
}

console.log(`\nğŸš€ Slit í”„ë¡œì íŠ¸ë¥¼ ìƒì„±í•˜ëŠ” ì¤‘: ${projectName}\n`);

// í…œí”Œë¦¿ í´ë” ê²½ë¡œ
const templateDir = path.join(__dirname, '..', 'template');

// í´ë” ë³µì‚¬ í•¨ìˆ˜
function copyDirectory(src, dest) {
  // ëŒ€ìƒ í´ë” ìƒì„±
  fs.mkdirSync(dest, { recursive: true });

  // í´ë” ë‚´ìš© ì½ê¸°
  const entries = fs.readdirSync(src, { withFileTypes: true });

  for (const entry of entries) {
    const srcPath = path.join(src, entry.name);
    const destPath = path.join(dest, entry.name);

    if (entry.isDirectory()) {
      // í´ë”ë©´ ì¬ê·€ì ìœ¼ë¡œ ë³µì‚¬
      copyDirectory(srcPath, destPath);
    } else {
      // íŒŒì¼ì´ë©´ ë³µì‚¬
      fs.copyFileSync(srcPath, destPath);
    }
  }
}

try {
  // í…œí”Œë¦¿ ë³µì‚¬
  copyDirectory(templateDir, targetDir);

  console.log('âœ… í”„ë¡œì íŠ¸ê°€ ì„±ê³µì ìœ¼ë¡œ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤!\n');
  console.log('ë‹¤ìŒ ë‹¨ê³„:');
  console.log(`  cd ${projectName}`);
  console.log('  # í”„ë¡œì íŠ¸ ì‘ì—…ì„ ì‹œì‘í•˜ì„¸ìš”!\n');
  console.log('ğŸ“ ìƒì„±ëœ êµ¬ì¡°:');
  console.log(`  ${projectName}/`);
  console.log('    â”œâ”€â”€ docs/           # ë¬¸ì„œ ë° í”„ë¡¬í”„íŠ¸');
  console.log('    â”œâ”€â”€ .claude/        # Claude ì„¤ì •');
  console.log('    â””â”€â”€ README.md       # í”„ë¡œì íŠ¸ ì„¤ëª…\n');

} catch (error) {
  console.error('âŒ í”„ë¡œì íŠ¸ ìƒì„± ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤:', error.message);
  process.exit(1);
}
